import{d as B,x as j,r as v,m as x,e as d,F as R,y as U,k as l,z as H,t as g,_ as M,u as A,A as E,o as r,c as p,w as i,a as s,I as F,B as D,C as w,D as f,E as W,G as b,H as N,b as c,J as C,K as G,L as z,M as J,p as q,f as h,N as K,O as Q,P as X,Q as Z,R as ee,S as te,T as ae,U as se,V as oe,W as ne,X as ie,Y as ce,Z as de,g as le,$ as re,a0 as O,j as ue,a1 as _e,h as pe}from"./index-Dq5IbgG3.js";import{d as P}from"./dayjs.min-CxMP4GVf.js";import{s as me,a as ye}from"./vue-virtual-scroller.esm-ypv9sbEd.js";const fe={class:"picker-wrapper"},he=["onClick"],ge={class:"weekday"},ve={class:"day"},ke={class:"month"},De=B({__name:"DatePicker",emits:["selectedDate"],setup(V,{emit:I}){const m=I,u=v(null),_=v(new Date),y=v([]),S=["日","一","二","三","四","五","六"],T=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],L=()=>{const e=[],t=new Date;for(let o=-15;o<=15;o++){const n=new Date(t);n.setDate(t.getDate()+o),e.push({date:new Date(n),day:n.getDate(),month:T[n.getMonth()],weekday:S[n.getDay()],timestamp:n.getTime()})}y.value=e},$=e=>{_.value=new Date(e.date),m("selectedDate",P(_.value).format("YYYY-MM-DD"))},k=e=>e.date.toDateString()===_.value.toDateString(),a=e=>{const t=new Date;return e.date.toDateString()===t.toDateString()};return j(()=>{L(),setTimeout(()=>{if(u.value){const e=u.value.querySelector(".selected");e&&e.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}},100)}),(e,t)=>(l(),x("div",fe,[d("div",{class:"dates-container",ref_key:"datesContainer",ref:u},[(l(!0),x(R,null,U(y.value,o=>(l(),x("div",{key:o.timestamp,class:H(["date-item",{selected:k(o),today:a(o)}]),onClick:n=>$(o)},[d("div",ge,g(o.weekday),1),d("div",ve,g(o.day),1),d("div",ke,g(o.month),1)],10,he))),128))],512)]))}}),we=M(De,[["__scopeId","data-v-c82963e0"]]),Ce={class:"ion-display-flex ion-justify-content-between ion-align-items-center"},xe={class:"ion-display-flex ion-align-items-center ion-padding-horizontal"},Ie=["src"],Se={class:"card-wrapper"},Te={class:"ion-display-flex ion-align-items-center"},Le={class:"ion-display-flex ion-justify-content-between ion-align-items-center"},$e={class:"ion-display-flex ion-justify-content-end"},be={key:1,class:"ion-display-flex ion-flex-column ion-justify-content-center ion-align-items-center no_data"},Ne=B({__name:"HomePage",setup(V){const I=ue(),m=A(),u=v([]),_=v(null),y=async()=>{const a=m.uid;if(!a){r("請先登入","danger");return}try{const e=await D(w(f,"todoList",a,"todos"));e.empty?u.value=[]:u.value=e.docs.map(t=>({id:t.data().id,date:t.data().date,time:t.data().time,content:t.data().content,check:t.data().check}))}catch(e){r(e,"danger")}},S=async a=>{const e=m.uid;if(!e){r("請先登入","danger");return}const t=b(w(f,"todoList",e,"todos"),N("id","==",a.id));try{const o=await D(t);await re(O(f,"todoList",e,"todos",o.docs[0].id)),r("刪除成功","success")}catch(o){r(o,"danger")}y()},T=(a,e)=>{I.push({name:"editTodo",params:{id:e},query:{date:a}})},L=async a=>{const e=m.uid;if(!e){r("請先登入","danger");return}const t=b(w(f,"todoList",e,"todos"),N("id","==",a.id));try{const o=await D(t),n=O(f,"todoList",e,"todos",o.docs[0].id);await _e(n,{check:!0}),r("更新成功","success")}catch(o){r(o,"danger")}y()},$=()=>new Promise(a=>{const e=W(pe,t=>{e(),a(t)})}),k=async a=>{const e=m.uid;if(!e){r("請先登入","danger");return}const t=b(w(f,"todoList",e,"todos"),N("date","==",a)),o=await D(t);u.value=o.docs.map(n=>({...n.data()}))};return E(async()=>{const a=await $();_.value={uid:a==null?void 0:a.uid,email:a==null?void 0:a.email,displayName:a==null?void 0:a.displayName,photoURL:a==null?void 0:a.photoURL},m.saveUserInfo(_.value),a?(y(),k(P(new Date).format("YYYY-MM-DD"))):r("使用者未登入","danger")}),(a,e)=>(l(),p(s(F),null,{default:i(()=>[c(s(X),{class:"ion-no-border"},{default:i(()=>{var t;return[c(s(G),{class:"ion-toolbar"},{default:i(()=>[d("div",Ce,[c(s(z),{slot:"start"},{default:i(()=>[c(s(J),{class:"ion-padding-horizontal"},{default:i(()=>[...e[0]||(e[0]=[q("TODOLIST",-1)])]),_:1})]),_:1}),d("div",xe,[c(s(z),{slot:"end",class:"icon_area"},{default:i(()=>{var o;return[(o=_.value)!=null&&o.uid?(l(),p(s(Q),{key:1},{default:i(()=>{var n;return[d("img",{class:"user-photo",src:(n=_.value)==null?void 0:n.photoURL,alt:"用戶頭像",referrerpolicy:"no-referrer"},null,8,Ie)]}),_:1})):(l(),p(s(h),{key:0,class:"icon_area_img","aria-hidden":"true",size:"large",icon:s(K)},null,8,["icon"]))]}),_:1})])])]),_:1}),(t=_.value)!=null&&t.uid?(l(),p(we,{key:0,onSelectedDate:k})):C("",!0)]}),_:1}),c(s(le),{fullscreen:!0,class:"page-content"},{default:i(()=>[u.value.length?(l(),p(s(me),{key:0,class:"scroller",items:u.value,"min-item-size":200},{default:i(({item:t,index:o,active:n})=>[c(s(ye),{item:t,active:n,"size-dependencies":[t.content],"data-index":o},{default:i(()=>[d("div",Se,[c(s(Z),{class:"ion-padding"},{default:i(()=>[c(s(ee),{class:"ion-no-padding ion-padding-vertical"},{default:i(()=>[d("div",Te,[c(s(te),null,{default:i(()=>[q(g(t.content),1)]),_:2},1024),t.check?(l(),p(s(h),{key:0,class:"pl-2",color:"primary",icon:s(ae)},null,8,["icon"])):C("",!0)])]),_:2},1024),c(s(se),{class:"ion-no-padding"},{default:i(()=>[d("div",Le,[d("div",null,[c(s(oe),null,{default:i(()=>[q(g(t.date)+" "+g(t.time),1)]),_:2},1024)]),d("div",$e,[t.check?C("",!0):(l(),p(s(h),{key:0,color:"primary",icon:s(ne),onClick:Y=>T(t.date,t.id)},null,8,["icon","onClick"])),t.check?C("",!0):(l(),p(s(h),{key:1,color:"success",icon:s(ie),onClick:Y=>L(t)},null,8,["icon","onClick"])),c(s(h),{color:"danger",icon:s(ce),onClick:Y=>S(t)},null,8,["icon","onClick"])])])]),_:2},1024)]),_:2},1024)])]),_:2},1032,["item","active","size-dependencies","data-index"])]),_:1},8,["items"])):(l(),x("div",be,[c(s(h),{icon:s(de),class:"empty_status"},null,8,["icon"]),e[1]||(e[1]=d("div",{class:"empty_title"},"目前尚無資料...",-1))]))]),_:1})]),_:1}))}}),Oe=M(Ne,[["__scopeId","data-v-dd3f6fa5"]]);export{Oe as default};
